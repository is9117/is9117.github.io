<!DOCTYPE html>
<html lang="ko" prefix="og: http://ogp.me/ns#">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Metadata -->
	<meta name="description" content="">
	<meta property="og:description" content="">
	<meta property="og:title" content="pytest in python" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://is9117.github.io/pytest-in-python.html" />
		<meta property="og:image" content="https://is9117.github.io/images/" />

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>Isaac's Tech Blog</title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://is9117.github.io/theme/css/poole.css" />
		<link rel="stylesheet" href="https://is9117.github.io/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://is9117.github.io/theme/css/syntax.css" />
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" crossorigin="anonymous">

		<!-- Feeds -->
<link href="https://is9117.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Isaac's Tech Blog Full Atom Feed" />
<link href="https://is9117.github.io/feeds/backend.atom.xml" type="application/atom+xml" rel="alternate" title="Isaac's Tech Blog Categories Atom Feed" />

		<!-- Analytics -->
	</head>

	<body class="theme-base-0d">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="https://is9117.github.io/">
					<img class="profile-picture" src="https://is9117.github.io/images/">
					Isaac's Tech Blog
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead"> </p>
			<p></p>
		</div>
			<ul class="sidebar-nav">
			</ul>
		<nav class="sidebar-social">
					<a class="sidebar-social-item" href="#" target="_blank">
						<i class="fa fa-You can add links in your config file"></i>
					</a>
					<a class="sidebar-social-item" href="#" target="_blank">
						<i class="fa fa-Another social link"></i>
					</a>
			<a class="sidebar-social-item" href="https://is9117.github.io/feeds/all.atom.xml">
				<i class="fa fa-rss"></i>
			</a>
		</nav>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">pytest in python</h1>
	<span class="post-date">Mon 08 January 2024</span>
	<h2>ğŸ—‚ï¸ëª©ì°¨</h2>
<hr>
<h2>ğŸ¯Abstract</h2>
<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” pytest êµ¬ì„± ë° í™œìš© ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p>
<p>íŠ¹íˆ, ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê´€ëœ í…ŒìŠ¤íŠ¸ ìë™í™”ê°€ ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€, ì´ë¥¼ ì–´ë–»ê²Œ ì„¤ê³„í•˜ê³  ì‹¤í–‰í•˜ëŠ”ì§€ì— ëŒ€í•´ ë‹¤ë£¹ë‹ˆë‹¤.</p>
<p>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•ê³¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• ë°©ì‹ì— ëŒ€í•´ì„œë„ ì„¤ëª…í•˜ë©°, ì´ë¯¸ êµ¬í˜„ëœ ì»¤ë²„ë¦¬ì§€ í…ŒìŠ¤íŠ¸ì˜ ì‹¤í–‰ ë°©ë²•ê³¼ ê´€ë ¨ëœ ì•„ì´ë””ì–´ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.</p>
<p>ë˜í•œ, Github Actionsë¥¼ í™œìš©í•œ CI í…ŒìŠ¤íŠ¸ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ êµ¬í˜„ ê³¼ì •ì„ ì†Œê°œí•©ë‹ˆë‹¤. PR ìƒì„± ì‹œ í•„ìˆ˜ ë¨¸ì§€ ì¡°ê±´ ì„¤ì • ë°©ë²•ê³¼ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • ê°€ëŠ¥ì„±ì— ëŒ€í•´ì„œë„ ì„¤ëª…í•©ë‹ˆë‹¤.</p>
<h2>âš™ï¸PyTest</h2>
<h3>pytestë¥¼ ì„ íƒí•œ ì´ìœ </h3>
<p>Pythonì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œëŠ” pytestì™€ unittestê°€ ìˆìŠµë‹ˆë‹¤.</p>
<p>pytestëŠ” 3rd-party ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ë‹¤ì–‘í•œ ê¸°ëŠ¥ê³¼ ìµœì‹  IDEì™€ì˜ ë›°ì–´ë‚œ í˜¸í™˜ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
unittestëŠ” Python í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì¼ë¶€ë¡œ, JUnit(Java unit-test) ìŠ¤íƒ€ì¼ì˜ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ì§ê´€ì ì´ê³  ê°„ë‹¨í•œ ì‚¬ìš©ë²•ì´ ì¥ì ì…ë‹ˆë‹¤.
ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ë§Œ, pytestëŠ” hookì´ë‚˜ scope fixture ë“± ë” ë³µì¡í•˜ê³  ìœ ì—°í•œ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>
<p>ì œê°€ pytestë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>
<p>ë§ì€ Python ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë®¤ë‹ˆí‹°ê°€ pytestë¥¼ í‘œì¤€ìœ¼ë¡œ ì±„íƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.
ë¯¸ë˜ì˜ í™•ì¥ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ë¥¼ ê³ ë ¤í•œ future-proof ì„ íƒì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>
<h3>framework or vanilla approach</h3>
<p>í…ŒìŠ¤íŠ¸ë¥¼ ì„¤ê³„í•  ë•Œ, ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§ì¶¤í˜• í…ŒìŠ¤íŠ¸ frameworkë¥¼ êµ¬ì¶•í•˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Win32 APIë¥¼ ê¸°ë°˜ìœ¼ë¡œ MFCë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì²˜ëŸ¼, pytestë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ì í•©í•œ ë§ì¶¤í˜• frameworkë¥¼ ë§Œë“¤ì–´ ì¬í™œìš©ì„±ê³¼ ì¶”ìƒí™”ë¥¼ í†µí•´ ìƒì‚°ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>í•˜ì§€ë§Œ ì´ëŸ¬í•œ framework ì ‘ê·¼ë²•ì—ëŠ” ëª‡ ê°€ì§€ í•œê³„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤:</p>
<p>Framework ìì²´ í…ŒìŠ¤íŠ¸ í•„ìš”ì„±
Frameworkë¥¼ ë§Œë“¤ë‹¤ ë³´ë©´ ê·¸ ìì²´ë¥¼ í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ë²„ê·¸ê°€ ìˆ¨ì–´ ìˆì–´ë„ ì´ë¥¼ ë°œê²¬í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ë¬¸ì„œí™”ì˜ ë¶€ì¡±
íŠ¹íˆ ì²˜ìŒ frameworkë¥¼ ì ‘í•˜ëŠ” ê°œë°œìë“¤ì—ê²Œ, ë¬¸ì„œí™”ê°€ ë¶€ì¡±í•œ frameworkëŠ” ì ìš© ë° í•™ìŠµì˜ í° ì¥ë²½ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œëŠ” ì¢…ì¢… ë§ì¶¤í˜• í…ŒìŠ¤íŠ¸ frameworkì—ì„œë„ ë°œê²¬ë©ë‹ˆë‹¤.</p>
<p>ê·¸ë˜ì„œ ì„ íƒí•œ Vanilla Approach
ì´ëŸ° ì´ìœ ë¡œ, ê°€ëŠ¥í•œ í•œ pytestì˜ ê¸°ë³¸ ê¸°ëŠ¥ì„ ìµœëŒ€í•œ í™œìš©í•˜ê³ , ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” boilerplate ì½”ë“œëŠ” helperë¡œ ë¶„ë¦¬í•˜ëŠ” vanilla approachë¥¼ ì±„íƒí–ˆìŠµë‹ˆë‹¤.</p>
<p>ì´ ì ‘ê·¼ë²•ì€ ê°„ë‹¨í•˜ê³  ì§ê´€ì ì´ë©°, ì¶”ê°€ì ì¸ í•™ìŠµ ì—†ì´ë„ pytestì˜ ê¸°ë³¸ ë¬¸ì„œë§Œìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì´í•´í•˜ê³  ì‘ì„±í•  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.
ë¯¸ë˜ì˜ í™•ì¥ì„±
í…ŒìŠ¤íŠ¸ê°€ ì ì  ë³µì¡í•´ì§€ê³  ì–‘ì´ ì¦ê°€í•˜ë©´ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì„ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<p>MSA(Microservices Architecture)ë¡œ ë„ë©”ì¸ ë¶„ë¦¬
í…ŒìŠ¤íŠ¸ ë²”ìœ„ë¥¼ ì¤„ì´ê³  ë…ë¦½ì„±ì„ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê¸°íƒ€ ìƒˆë¡œìš´ ë°©ë²•ë¡  ë„ì…
í”„ë¡œì íŠ¸ì˜ ì„±ì¥ê³¼ í•¨ê»˜ ë³´ë‹¤ ì í•©í•œ ë„êµ¬ë‚˜ ì„¤ê³„ë¥¼ ê³ ë ¤í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.</p>
<h3>fixture and scope</h3>
<p>pytest fixtureëŠ” í…ŒìŠ¤íŠ¸ ê°„ ê³µìœ ë˜ëŠ” setupì´ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤. constructorì™€ destructorê°€ ìˆì–´, í•„ìš” ì‹œ ì‹¤í–‰ ì‹œ ìƒì„±ë˜ëŠ” ì½”ë“œ, ì¢…ë£Œ ì‹œ ì œê±°ë˜ëŠ” ì½”ë“œë¥¼ ì •ì˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Senior</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Student</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">STUDENT</span><span class="o">.</span><span class="n">SENIOR</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="c1"># constructor</span>
    <span class="n">util_obj</span> <span class="o">=</span> <span class="n">Uitls</span><span class="p">()</span>

    <span class="c1"># yield return</span>
    <span class="k">yield</span> <span class="n">util_obj</span>

    <span class="c1"># destructor</span>
    <span class="n">util_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div>

<p>fixtureì—ëŠ” scopeì´ë€ ìš©ì–´ë¡œ í…ŒìŠ¤íŠ¸ê°„ ê³µìœ ë˜ëŠ” ë²”ìœ„ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>scopeì— ë”°ë¼ ë²”ìœ„ê¸°ì¤€ìœ¼ë¡œ fixtureê°€ ì¬í™œìš©ë ì§€, ë‹¤ì‹œ ìƒì„±í•  ì§€ ê²°ì •ë©ë‹ˆë‹¤.</p>
<p><strong>scope</strong>:</p>
<ul>
<li>function: ê¸°ë³¸ê°’, ë¯¸ì§€ì • ì‹œ ê¸°ë³¸ì„¤ì •, í•¨ìˆ˜ ì‹œì‘ ì „í›„ë¡œ ë¦¬ì…‹ ë¨</li>
<li>class: classê°„ ì¬í™œìš©ë˜ëŠ” scope</li>
<li>module</li>
<li>package</li>
<li>session: ì „ì²´ í…ŒìŠ¤íŠ¸ ì„¸ì…˜ì— ê³µìœ ë¨, global scopeì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŒ, multi processingìœ¼ë¡œ test runì‹œ ì—¬ëŸ¬ sessionì´ ìˆì„ ìˆ˜ ìˆìŒ</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;session&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sess</span><span class="p">():</span>
    <span class="c1"># global initialization here</span>
    <span class="o">...</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">():</span>
    <span class="c1"># setup class here</span>
    <span class="n">yeild</span>
    <span class="c1"># tear down class here</span>

<span class="c1"># fixtureë¥¼ parameterì‚¬ìš©í•˜ì§€ ì•Šê³  ì ìš©í•˜ëŠ” ë°©ë²•</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s1">&#39;setup&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestClass1</span><span class="p">:</span>
    <span class="c1"># ëª¨ë“  test methodê°€ ì‹¤í–‰ ì „ì— setup ì‹¤í–‰</span>
    <span class="c1"># ëª¨ë“  test method ì¢…ë£Œ í›„ tear down ë¶€ë¶„ ì‹¤í–‰</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_case1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_case2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div>

<p><strong>reference</strong>:</p>
<p>í…ŒìŠ¤íŠ¸ê°€ fixtureë¥¼ ì‚¬ìš©í•˜ëŠ”ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_baa</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
    <span class="c1"># &#39;Hello&#39; ì¶œë ¥</span>
</code></pre></div>

<p>fixtureëŠ” ê¼­ ê°™ì€ moduleì„œ ì •ì˜ë  í•„ìš” ì—†ìŠµë‹ˆë‹¤.</p>
<p>ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì •ì˜ í›„ import í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: foo.py</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello&#39;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: bar.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">foo</span> <span class="n">impor</span> <span class="n">foo</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_bar</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
    <span class="c1"># &#39;Hello&#39; ì¶œë ¥</span>
</code></pre></div>

<p>pytestëŠ” hookì´ë‚˜ ê³µìš© fixtureë¥¼ ëª…ì‹œ í•  ìˆ˜ ìˆëŠ” íŠ¹ë³„ ëª¨ë“ˆì´ ìˆìŠµë‹ˆë‹¤.</p>
<p><code>conftest.py</code>ì´ë¦„ì˜ íŒŒì¼ ì•„ë˜ ëª¨ë“  ëª¨ë“ˆì€ importì—†ì´ í•´ë‹¹ íŒŒì¼ ë‚´ ëª¨ë“  fixture ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ë¥¼ fixture discoveryë¼ê³  í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: tests/conftest.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;foo&#39;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: tests/bar.py</span>
<span class="c1"># import ë¶ˆí•„ìš”</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_bar</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
    <span class="c1"># &#39;foo&#39; ì¶œë ¥</span>
</code></pre></div>

<p>conftest.pyíŒŒì¼ì„ root directoryì— ì§€ì • ì‹œ í•´ë‹¹ íŒŒì¼ ë‚´ ëª¨ë“  hookì´ë‚˜ fixtureëŠ” ëª¨ë“  í…ŒìŠ¤íŠ¸ì— ì ìš©ë©ë‹ˆë‹¤. hook functionì— ê´€í•œ ë‚´ìš©ì€ ì•„ë˜ ì„¤ëª… ì°¸ê³  ë°”ëë‹ˆë‹¤.</p>
<p><strong>autouse</strong>:</p>
<p>autouseëŠ” fixtureë¥¼ referenceí•  ìˆ˜ ìˆëŠ” ëª¨ë“  testì— ë³„ë„ ê°ê° ëª…ì‹œí•  í•„ìš” ì—†ì´ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.</p>
<p>conftest.pyì— ëª…ì‹œëœ fixtureì— autouse=Trueí•  ì‹œ í•´ë‹¹ ë””ë ‰í† ë¦¬ ë‚´ ëª¨ë“  í…ŒìŠ¤íŠ¸ì—ëŠ” ê·¸ fixtureê°€ ìë™ ì ìš©ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: tests/conftest.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: tests/app/test_app.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_bar</span><span class="p">():</span>
    <span class="c1"># ì—¬ê¸°ì„œ &#39;foo&#39; ì¶œë ¥</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="c1"># &#39;bar&#39; ì¶œë ¥</span>
</code></pre></div>

<p>scopeì´ sessionì´ê³  autouse=True ì¼ì‹œ ëª¨ë“  ì ‘ê·¼ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ì— í•´ë‹¹ fixtureê°€ ìë™ ì ìš©ë˜ë©´ì„œ ê³µìœ ë˜ì–´ singleton ê°™ì€ íš¨ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨ databaseê´€ë ¨ singletoní™”ëŠ” transactionì— ì˜í•´ ì˜í–¥ì„ ë°›ì•„  ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(testì™€ transactionê´€ë ¨ì€ ì•„ë˜ ì°¸ê³ ).</p>
<h3>mark</h3>
<p>pytest.markê¸°ëŠ¥ì€ í…ŒìŠ¤íŠ¸ì— ì»¤ìŠ¤í…€ íŠ¹ì§•ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><strong>pytest.mark.usefixtures:</strong> </p>
<p>parameterì‚¬ìš©í•˜ì§€ ì•Šê³  fixtureë¥¼ í…ŒìŠ¤íŠ¸ì— ì ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_bar</span><span class="p">():</span>
    <span class="c1"># foo fixture starts here</span>
    <span class="o">...</span>
</code></pre></div>

<p><strong>pytest.mark.skip:</strong></p>
<p>í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ìœ ì§€í•œì²´ ì‹¤í–‰ ì‹œ í…ŒìŠ¤íŠ¸ë¥¼ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;í˜¸í™˜ì„± ì´ìŠˆ&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_foo</span><span class="p">():</span>
    <span class="c1"># skipped during test run</span>
    <span class="o">...</span>
</code></pre></div>

<p><strong>pytest.mark.parametrize:</strong></p>
<p>ë™ì¼ í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ë¥¸ íŒŒë¼ë¯¸í„° ì¡°ê±´ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìƒì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;cond&#39;</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">),</span>
        <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_always_true</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="c1"># True == True ì™€ False == False ë‘ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ ë¨</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<p><strong>pytest.mark.django_db:</strong></p>
<p>django ORMì„ ì ‘ê·¼í•˜ê¸° ìœ„í•´ í•„ìš”í•œ markì…ë‹ˆë‹¤. pytest-django pakcageì˜ ì»¤ìŠ¤í…€ markì…ë‹ˆë‹¤.</p>
<p>pytestì™€ databaseê´€ë ¨í•´ì„œëŠ” ì•„ë˜ ì°¸ê³  ë°”ëŒ</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_user</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">MedicalStaffFactory</span><span class="p">()</span>
    <span class="n">user</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div>

<h3>assert</h3>
<p>í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ë‚´ ë™ì‘ê²°ê³¼ê°€ ì›í•˜ê²Œ ë™ì‘í–ˆëŠ”ì§€ ì‹¤íŒ¨ì²˜ë¦¬í•´ì•¼í•  ì§€ë¥¼ ëª…ì‹œí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>
<p><strong>ê¸°ë³¸ì‚¬ìš©ë²•</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_foo</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">True</span> <span class="ow">is</span> <span class="kc">True</span>    <span class="c1"># ì„±ê³µ</span>
    <span class="k">assert</span> <span class="kc">True</span> <span class="ow">is</span> <span class="kc">False</span>   <span class="c1"># ì‹¤íŒ¨, test runì—ì„œ ì‹¤íŒ¨ ë° error message</span>
    <span class="k">assert</span> <span class="kc">True</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;reason here&#39;</span>
</code></pre></div>

<p><strong>exception</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_exception</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>  <span class="c1"># ì„±ê³µ</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
</code></pre></div>

<h3>mocker</h3>
<p>mockerëŠ” í…ŒìŠ¤íŠ¸ ì‹œ ì¼ë¶€ ëª¨ë“ˆì´ë‚˜ 3rd partyë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í–‰ìœ„ë¥¼ ì¡°ì¢…í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<p>ë³µì¡í•œ ë‚´ë¶€ ë¡œì§ì„ ìƒëµí•˜ê±°ë‚˜, í˜¸ì¶œë˜ë©´ ì•ˆë˜ëŠ”(ì˜ˆì‹œ: twilo API í˜¸ì¶œ) 3rd party ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‹¤ì œë¡œ í˜¸ì¶œí•˜ì§€ ì•Šê³  í˜¸ì¶œ ëœê±¸ë¡œ ê°„ì£¼í•˜ê²Œ í•˜ì—¬ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì •ì—†ì´ í•´ë‹¹ ë¡œì§ì„ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>mockerëŠ” ë°˜í™˜ê°’ì„ ë³€í™˜ì‹œí‚¤ê±°ë‚˜, ì…ë ¥ê°’ì´ ë¬´ì—‡ì¸ì§€ ì•Œ ìˆ˜ ìˆê³ , í˜¸ì¶œì—¬ë¶€, í˜¸ì¶œê°œìˆ˜ ë„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>pytestì˜ ê¸°ë³¸ mockê¸°ëŠ¥ ë„ ìˆì§€ë§Œ ì—¬ê¸°ì„œëŠ” pytest-mocker íŒ¨í‚¤ì§€ì˜ mockerë¼ëŠ” fixtureë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p><strong>return ê°’ ë³€ê²½:</strong></p>
<p>ì•„ë˜ì²˜ëŸ¼ ì§€ì • ëª¨ë“ˆì˜ í´ë¼ìŠ¤, í•¨ìˆ˜ê¹Œì§€ ë°˜í™˜ê°’ì„ ë³€í™˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: myapp/tests/test_serializers.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_check_token_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">mocker</span><span class="p">):</span>
    <span class="n">uid_b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">TokenGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">make_token</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">PasswordResetSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;newpassword&#39;</span><span class="p">,</span>
        <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
        <span class="s1">&#39;uid_b64&#39;</span><span class="p">:</span> <span class="n">uid_b64</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;myapp.serializers.TokenGenerator.check_token&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">AuthenticationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;The reset link is invalid&#39;</span>
    <span class="k">assert</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">401</span>

<span class="c1"># ìœ„ì¹˜: myapp/serializers.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">some_library.tokens</span><span class="w"> </span><span class="kn">import</span> <span class="n">TokenGenerator</span>  <span class="c1"># ì´ê±°ë¥¼ mock</span>
<span class="o">...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PasswordResetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">TokenGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">check_token</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">AuthenticationError</span><span class="p">(</span><span class="s1">&#39;The reset link is invalid&#39;</span><span class="p">,</span> <span class="mi">401</span><span class="p">)</span>
        <span class="o">...</span>
</code></pre></div>

<p><strong>í•¨ìˆ˜ í˜¸ì¶œì •ë³´ í™•ì¸:</strong></p>
<p>ì•„ë˜ ì²˜ëŸ¼ ì§€ì • í•¨ìˆ˜ì˜ í˜¸ì¶œì—¬ë¶€ì™€ ì–´ë–¤ íŒŒë¼ë¯¸í„°ê°€ ì…ë ¥ ëëŠ”ì§€ë„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: myapp/tests/test_views.py</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span><span class="p">()</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s1">&#39;auth_token&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestResetEmailWithTokenView</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_reset_email_with_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">api_client</span><span class="p">,</span> <span class="n">mocker</span><span class="p">):</span>

        <span class="c1"># í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì •</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;reset-email-with-token&#39;</span><span class="p">)</span>
        <span class="n">acc_token</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_new_tokens</span><span class="p">(</span><span class="s1">&#39;web-client&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">acc_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>

        <span class="n">mock_serializer</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;myapp.views.ResetEmailWithTokenView.serializer_class&#39;</span><span class="p">)</span>
        <span class="n">mock_serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mock_serializer</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ìš”ì²­ ì „ì†¡</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">api_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{},</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>

        <span class="c1"># is_valid íŒŒë¼ë¯¸í„° í™•ì¸</span>
        <span class="k">assert</span> <span class="n">mock_serializer</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">mock_serializer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">user</span>

<span class="c1"># ìœ„ì¹˜: myapp/views.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResetEmailWithTokenView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">GenericAPIView</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ResetEmailWithTokenSerializer</span>
    <span class="n">renderer_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">CustomResultRenderer</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
</code></pre></div>

<h3>unittestì™€ì˜ í˜¸í™˜ì„±</h3>
<p>pytestëŠ” ê¸°ë³¸ì ìœ¼ë¡œ python unittest, nose í…ŒìŠ¤íŠ¸ê°€ 100% í˜¸í™˜ë©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì‘ì„±ì„ unittest ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ì‹œë©´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<h3>í…ŒìŠ¤íŠ¸ discovery</h3>
<p>pytestëŠ” ì„¤ì •ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ì°¾ê²Œ ë©ë‹ˆë‹¤.</p>
<p>ì—¬ê¸°ì„œëŠ” <code>pytest.ini</code>íŒŒì¼ì— ê¸°ë³¸ì„¤ì •ì´ ìˆê³  pytestë„ ì°¸ê³ í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="n">myapp</span><span class="o">.</span><span class="n">settings</span>
<span class="n">addopts</span> <span class="o">=</span> <span class="o">--</span><span class="n">reuse</span><span class="o">-</span><span class="n">db</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">warnings</span> <span class="o">--</span><span class="n">nomigrations</span>
<span class="n">python_files</span> <span class="o">=</span> <span class="n">test</span><span class="o">*.</span><span class="n">py</span>
<span class="n">python_functions</span> <span class="o">=</span> <span class="n">test</span><span class="o">*</span>
</code></pre></div>

<p>ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œëŠ” <code>test*.py</code> íŒ¨í„´ì˜ íŒŒì¼ëª… ëª¨ë“ˆì„ ìë™ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.</p>
<p>pytest ê¸°ë³¸ê°’ìœ¼ë¡œ <code>Test*</code> íŒ¨í„´ì˜ classë¥¼ ì°¾ê±°ë‚˜ ì„¤ì •ìœ¼ë¡œ <code>test*</code> íŒ¨í„´ì˜ í•¨ìˆ˜ë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: myapp/tests/test_serializers.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestTokenAuthenticationSerializer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="o">...</span>
</code></pre></div>

<h3>reference</h3>
<p>ìµœëŒ€í•œ êµ¬í˜„ëœ í…ŒìŠ¤íŠ¸ ë²”ìœ„ë¡œ ì„¤ëª…ì„ êµ­í•œí–ˆìŠµë‹ˆë‹¤.</p>
<p>ë” ìì„¸í•œ ì‚¬ìš©ë²•ì€ <a href="https://docs.pytest.org/en/latest/index.html">ê³µì‹ë¬¸ì„œ</a> ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p>
<h2>ğŸ—„ï¸Djangoì™€ databaseê´€ë ¨</h2>
<p>djangoì˜ ê¸°ëŠ¥ì„ pytestì„œ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ <code>pytest-django</code> íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>django ORMì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” django testì—ì„œëŠ” ê¸°ë³¸ìœ¼ë¡œ test databaseë¥¼ ìƒì„±í•˜ì—¬ default databaseì™€ ë¶„ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
<p><img alt="pytestì„œ ìƒì„±ëœ test_*****_local schema" src="../images/python_unittest/Untitled.png"></p>
<p>pytestì„œ ìƒì„±ëœ test_<strong>*</strong>_local schema</p>
<p>ëª¨ë“  django databaseê´€ë ¨ í…ŒìŠ¤íŠ¸ëŠ” transactionì´ ê±¸ë¦¬ê²Œ ë©ë‹ˆë‹¤.</p>
<p>test function í˜¹ì€ class, module ë§ˆë‹¤ transactionì´ rollback(í˜¹ì€ trauncate) ë˜ë©°
ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì™€ isolationì„ ì§€ì›í•©ë‹ˆë‹¤.</p>
<p>django ORMì‚¬ìš© í…ŒìŠ¤íŠ¸ëŠ” ì•„ë˜ markë¥¼ ì ìš©í•´ì•¼ ë™ì‘í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># í•¨ìˆ˜ì— django_db ì ìš©</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_foo</span><span class="p">():</span>
    <span class="c1"># some database access here</span>
  <span class="o">...</span>

<span class="c1"># classì— django_db ì ìš©</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestCase1</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">test_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">passs</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ëª¨ë“ˆ ì „ì²´ django_db ì ìš©</span>
<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>

<span class="c1"># test code here</span>
<span class="o">...</span>
</code></pre></div>

<h3>ê¸°ë³¸ ì‹¤í–‰ ì„¤ì •</h3>
<p>ì•„ë˜ ì²˜ëŸ¼ ë””ë¹„ê´€ë ¨ ê¸°ë³¸ ì‹¤í–‰ ì˜µì…˜ì€ <code>â€”-reuse-db â€”-nomigrations</code>ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="n">myapp</span><span class="o">.</span><span class="n">settings</span>
<span class="n">addopts</span> <span class="o">=</span> <span class="o">--</span><span class="n">reuse</span><span class="o">-</span><span class="n">db</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">warnings</span> <span class="o">--</span><span class="n">nomigrations</span>
<span class="n">python_files</span> <span class="o">=</span> <span class="n">test</span><span class="o">*.</span><span class="n">py</span>
<span class="n">python_functions</span> <span class="o">=</span> <span class="n">test</span><span class="o">*</span>
</code></pre></div>

<p>ì†ë„ ë•Œë¬¸ì— testë””ë¹„ë¥¼ ë§¤ë²ˆ ì¬ìƒì„±, ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ì§€ ì•Šê³  ì¬ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
<p>í˜¹ì‹œ í…ŒìŠ¤íŠ¸ ì¤‘ ë°ì´í„°ë² ì´ìŠ¤ì— ë‚¨ì€ ë°ì´í„°ê°€ ìˆì–´ ì¶©ëŒì´ ë‚˜ê±°ë‚˜, ë§ˆì´ê·¸ë ˆì´ì…˜ì— ë¬¸ì œê°€ ìˆì„ ê²½ìš°, í˜¹ì€ ìƒˆë¡œ ì¶”ê°€ ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš© í•˜ê¸° ìœ„í•´ì„œëŠ”  ì•„ë˜ ëª…ë ¹ì–´ë¡œ ë””ë¹„ ì¬ìƒì„±ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>--create-db<span class="w"> </span>--migrations
</code></pre></div>

<h2>ğŸª¨Custom Fixtures</h2>
<h3>mem_cache : fixture</h3>
<p>pytest(or unittest)ëŠ” cache isolationì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰ redisê°€ ë™ì¼í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
<p>pytest hookìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ëª¨ë“  redis ì¼€ì‹œë¥¼ ì§€ìš°ê¸´ í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ ê°„ì— ì¼€ì‹œê°€ ìë™ìœ¼ë¡œ ì›ë³µë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ì—ì„œ ìƒì„± ëœ ì¼€ì‹œë¡œ ì¸í•´ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì—ì„œ ë‹¨ë… ì‹¤í–‰ ì‹œ ë¬¸ì œì—†ë˜ ì½”ë“œê°€ ê°™ì´ ëŒë¦´ ì‹œ ì˜ˆìƒì¹˜ ëª»í•œ ì´ìŠˆë¥¼ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p>
<p>ì´ë¥¼ ë°©ì§€ í•˜ê¸° ìœ„í•´ì„œ in-memory cacheë¥¼ ì‚¬ìš©í•´ isolationì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ìœ„ì¹˜: myapp/tests/fixtures.py</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mem_cache</span><span class="p">():</span>    <span class="c1"># noqa</span>
    <span class="c1"># in-memory cache to isolate cache between tests</span>
    <span class="c1"># also isolates cache between processes, due to it allows one process to access the cache at a time</span>
    <span class="k">with</span> <span class="n">override_settings</span><span class="p">(</span><span class="n">CACHES</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.core.cache.backends.locmem.LocMemCache&#39;</span><span class="p">}}):</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">yield</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="c1"># ìœ„ì¹˜: myapp/tests/test_models.py</span>

<span class="c1"># using in-memory cache to isolate cache between tests</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span><span class="p">()</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s1">&#39;mem_cache&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMyModel</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_cache_key_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create an instance of the model</span>
        <span class="n">my_instance</span> <span class="o">=</span> <span class="n">MyModelFactory</span><span class="p">()</span>

        <span class="c1"># Cache key</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cache_key_prefix:model:</span><span class="si">{</span><span class="n">my_instance</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="c1"># Assert that the cache key is set correctly</span>
        <span class="k">assert</span> <span class="n">my_instance</span><span class="o">.</span><span class="n">cache_key</span> <span class="o">==</span> <span class="n">key</span>
</code></pre></div>

<p>ìœ„ ì˜ˆì œ ì²˜ëŸ¼, ì¼€ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤ì€ <code>mem_cache</code> fixutreë¥¼ ì‚¬ìš©í•˜ëŠ”ê±¸ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
<p>redis ê¸°ëŠ¥ì´ ê¼­ í•„ìš”í•˜ë‹¤ë©´ í…ŒìŠ¤íŠ¸ ì „ í›„ ë¡œ ë§¤ë²ˆ clearë¥¼ í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p>
<h2>ğŸ‘€code coverage</h2>
<p>ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë€ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì»¤ë²„í•˜ëŠ” ì½”ë“œì˜ ìˆ˜ì¹˜í™”ë¥¼ ë§í•©ë‹ˆë‹¤. instrument toolë¡œ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì‹œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤. ì»¤ë²„ë¦¬ì§€ ë°©ë²•ì— ë”°ë¼ ë‹¤ë¥¸ ê¸°ì¤€ìœ¼ë¡œ ì½”ë“œì˜ ì»¤ë²„ëœ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê²Œ ë˜ê³ , ë³´ê³ ë¡œ ì»¤ë²„ëœ ì½”ë“œì˜ ì¤„ ìˆ˜ë¥¼ ìˆ˜ì¹˜ë¡œ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì´ë¡œ ì¸í•´ í…ŒìŠ¤íŠ¸ë¥¼ ëª»í•œ ì½”ë“œê°€ ì–´ë””ì¸ì§€ ì „ì²´ ì½”ë“œ ì¤‘ ì–¼ë§ˆë‚˜ í…ŒìŠ¤íŠ¸ë¥¼ ì»¤ë²„ ëª»í–ˆëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img alt="coverage í…ŒìŠ¤íŠ¸ ì¶œë ¥ ì˜ˆì‹œ" src="../images/python_unittest/Untitled%201.png"></p>
<p>coverage í…ŒìŠ¤íŠ¸ ì¶œë ¥ ì˜ˆì‹œ</p>
<p>ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë°©ë²•ë¡  ì¤‘ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë°©ë²•ì€ line coverageì…ë‹ˆë‹¤. ì½”ë“œ ì¤„ì´ ì‹¤í–‰ ë  ê²½ìš° í…ŒìŠ¤íŠ¸ê°€ ëë‹¤ê³  ê°€ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<p>ë‹¤ë¥¸ ë°©ë²•ë¡ ìœ¼ë¡œëŠ” branch coverageì…ë‹ˆë‹¤. conditionì´ ìˆëŠ” ì½”ë“œ ì¤‘ ëª¨ë“  true false ì¡°ê±´ì´ ë‹¤ ì‹¤í–‰ë˜ì–´ì•¼ í•´ë‹¹ code blockì´ ì‹¤í–‰ëë‹¤ê³  ê°€ì •í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>
<p>ì €í¬ëŠ” ê°€ì¥ ê¸°ë³¸ìœ¼ë¡œ line coverageë°©ë²•ë¡ ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤(pytest-coverage ê¸°ë³¸ê°’).</p>
<p>ì¶” í›„ ì»¤ë²„ë¦¬ì§€ê°€ ì¶©ë¶„íˆ ì˜¬ë¼ì˜¤ê³ , ì¢€ ë” ì—„ê²©í•œ ê¸°ì¤€ì„ ì ìš©í•  ìˆ˜ ìˆì„ ë•Œ ë‹¤ë¥¸ ì»¤ë²„ë¦¬ì§€ ë°©ë²•ì„ ì‚¬ìš©í•˜ëŠ”ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
<p>ref: <a href="https://tecoble.techcourse.co.kr/post/2020-10-24-code-coverage/">https://tecoble.techcourse.co.kr/post/2020-10-24-code-coverage/</a></p>
<h2>ğŸ‘¥í…ŒìŠ¤íŠ¸ ë¬¸í™” ë° ì •ì±…</h2>
<p>í…ŒìŠ¤íŠ¸ ë¬¸í™”ë¥¼ ê°•í™”í•˜ê¸° ìœ„í•´ PRì— ì¶”ê°€ëœ ì½”ë“œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±ì„ í•„ìˆ˜í™”í•˜ê³ ì í•©ë‹ˆë‹¤. PRì— í¬í•¨ëœ ì½”ë“œ ë³€ê²½ ì‚¬í•­ì— ëŒ€í•´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ê±°ë‚˜ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.</p>
<p>GitHub Actionsë¥¼ í†µí•´ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•œ ê²½ìš°ì—ë§Œ PR ë³‘í•©ì„ í—ˆìš©í•˜ë©°, ì´ë¥¼ ì™„ì „íˆ ì ìš©í•˜ê¸° ìœ„í•œ ì ì‘ ê¸°ê°„ì„ ì •í•©ë‹ˆë‹¤.</p>
<p>ì´ˆê¸° ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€ì„ ì •í•˜ê³ , ì ì°¨ ìƒí–¥í•˜ì—¬ ì „ì²´ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ë¥¼ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•©ë‹ˆë‹¤.</p>
<p>í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì´ ëˆ„ë½ëœ ê²½ìš°, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ê°€ ë‚®ì•„ì ¸ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë”ë¼ë„ GitHub Actionsì—ì„œ ì‹¤íŒ¨ ì²˜ë¦¬ë˜ë¯€ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í…ŒìŠ¤íŠ¸ ì‘ì„± ë¬¸í™”ë¥¼ ì¥ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h2>ğŸƒì‹¤í–‰ë°©ë²•</h2>
<h3>Prerequisite</h3>
<p>í…ŒìŠ¤íŠ¸ ë””ë¹„ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ë””ë¹„ userì˜ ê¶Œí•œì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">OPTION</span><span class="p">;</span><span class="w"> </span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span>
</code></pre></div>

<p><code>requirements..txt</code> ì„¤ì¹˜</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements..txt
</code></pre></div>

<h3>ê¸°ë³¸ í…ŒìŠ¤íŠ¸</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ ì‹¤í–‰</span>
pytest

<span class="c1"># íŠ¹ì • í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‹¤í–‰</span>
pytest<span class="w"> </span>myapp/tests/test_models.py
pytest<span class="w"> </span>myapp/tests/test_views.py::TestTokenGeneration::test_token_generation_permission_check

<span class="c1"># ë©€í‹° í”„ë¡œì„¸ì‹± ì ìš©</span>
pytest<span class="w"> </span>-n<span class="w"> </span>auto
</code></pre></div>

<p>ê´€ë ¨ ì„¤ì •íŒŒì¼</p>
<ul>
<li>pytest.ini</li>
<li>myapp/settings/pytest.py</li>
</ul>
<p>ê¸°ë³¸ ì„¤ì •ì€ test ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•œë‹¤.</p>
<p>í˜¹ì‹œ í…ŒìŠ¤íŠ¸ ì¤‘ ë°ì´í„°ë² ì´ìŠ¤ ë‚¨ì€ë°ì´í„°ê°€ ìˆì–´ ì¶©ëŒì´ ë‚˜ê±°ë‚˜, ë§ˆì´ê·¸ë ˆì´ì…˜ì— ë¬¸ì œê°€ ìˆì„ ê²½ìš° í˜¹ì€ ìƒˆë¡œ ì¶”ê°€ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš© í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¡œ ë‹¤ì‹œ ë””ë¹„ìƒì„±ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">pytest</span><span class="w"> </span><span class="c1">--create-db --migrations</span>
</code></pre></div>

<h3>ì»¤ë²„ë¦¬ì§€ í…ŒìŠ¤íŠ¸</h3>
<p>line coverageë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.Â 
<a href="https://tecoble.techcourse.co.kr/post/2020-10-24-code-coverage/">ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ê´€ë ¨ë¸Œë¡œê·¸</a></p>
<div class="highlight"><pre><span></span><code>#<span class="w"> </span>ì „ì²´<span class="w"> </span>ë²”ìœ„
$<span class="w"> </span><span class="nv">pytest</span><span class="w"> </span><span class="o">--</span><span class="nv">cov</span><span class="o">=</span>.

#<span class="w"> </span>í…ŒìŠ¤íŠ¸<span class="w"> </span>ëª»í•œ<span class="w"> </span>ì½”ë“œ<span class="w"> </span>í‘œì‹œ
$<span class="w"> </span><span class="nv">pytest</span><span class="w"> </span><span class="o">--</span><span class="nv">cov</span><span class="o">-</span><span class="nv">report</span><span class="w"> </span><span class="nv">term</span><span class="o">-</span><span class="nv">missing</span><span class="w"> </span><span class="o">--</span><span class="nv">cov</span><span class="o">=</span>

#<span class="w"> </span><span class="mi">80</span><span class="o">%</span><span class="w"> </span>ì»¤ë²„ë¦¬ì§€<span class="w"> </span>ì´í•˜<span class="w"> </span>ì‹œ<span class="w"> </span><span class="k">exit</span><span class="w"> </span><span class="mi">1</span><span class="ss">(</span><span class="nv">fail</span><span class="ss">)</span>,<span class="w"> </span><span class="nv">CICD</span>ì—ì„œ<span class="w"> </span>ë§ì´<span class="w"> </span>ì‚¬ìš©
$<span class="w"> </span><span class="nv">pytest</span><span class="w"> </span><span class="o">--</span><span class="nv">cov</span><span class="o">=</span>.<span class="w"> </span><span class="o">--</span><span class="nv">cov</span><span class="o">-</span><span class="nv">fail</span><span class="o">-</span><span class="nv">under</span><span class="o">=</span><span class="mi">80</span>
</code></pre></div>

<h2>â›“ï¸Github Action(CI)</h2>
<p>github action scriptë¡œ íŠ¹ì • ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°ë¡œ ìë™ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Python Tests</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.9</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">python -m pip install --upgrade pip</span>
<span class="w">        </span><span class="no">pip install -r requirements.txt</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests with pytest</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">pytest --cov=myapp --cov-report=xml</span>
</code></pre></div>

		<span class="post-tags">
			Tags:
			<ul>
					<li><a href="https://is9117.github.io/tag/ci.html">CI</a></li>
					<li><a href="https://is9117.github.io/tag/backend.html">backend</a></li>
					<li><a href="https://is9117.github.io/tag/django.html">django</a></li>
					<li><a href="https://is9117.github.io/tag/git.html">git</a></li>
					<li><a href="https://is9117.github.io/tag/python.html">python</a></li>
					<li><a href="https://is9117.github.io/tag/pytest.html">pytest</a></li>
			</ul>
		</span>

</div>
		</div>
	</body>
</html>